name: sbom-analyzer
version: 1.0.0
description: |
  Analyzes Software Bill of Materials (SBOM) files to extract package information,
  verify repository status, and check for unmaintained dependencies.
  
  Supports multiple package ecosystems including npm, Go, .NET, PyPI, and more.
  
author: Kitty Team
license: MIT

variables:
  sbom_file: ""
  output_format: "markdown"

tasks:
  - name: find_github_packages
    description: Grep the SBOM file for GitHub packages only
    tool: execute_command
    input:
      command: grep -o 'pkg:golang/github.com/[^"]*' "${sbom_file}" | head -5
    output: github_purls_raw

  - name: extract_first_github_package
    description: Parse the first GitHub PURL and extract owner/repo info
    prompt: |
      Extract the first GitHub package URL from this command output:

      ${github_purls_raw}

      If the command succeeded, you'll see stdout with PURLs.
      If it failed, check stderr.

      Parse the FIRST GitHub PURL to extract repository information.

      For example, from "pkg:golang/github.com/gin-gonic/gin@v1.11.0":
      - owner: gin-gonic
      - repo: gin
      - github_url: https://github.com/gin-gonic/gin

      Return ONLY a JSON object (no markdown, no code blocks):
      {
        "owner": "username",
        "repo": "reponame",
        "github_url": "https://github.com/username/reponame",
        "purl": "full purl string",
        "name": "package-name",
        "version": "version"
      }
    output: package_info

  - name: get_github_repo_info
    description: Fetch GitHub repository information
    condition: package_info exists
    tool: github_repo_info
    input:
      owner: "${package_info.owner}"
      repo: "${package_info.repo}"
    output: repo_details

  - name: check_maintenance_status
    description: Check if the GitHub repository is actively maintained
    condition: repo_details exists
    tool: github_check_maintenance
    input:
      owner: "${package_info.owner}"
      repo: "${package_info.repo}"
    output: maintenance_status

  - name: generate_report
    description: Generate final security and maintenance report
    prompt: |
      Generate a comprehensive report for the analyzed package:

      Selected Package: ${package_info}
      Repository Details: ${repo_details}
      Maintenance Status: ${maintenance_status}

      Format the report as ${output_format} with:
      - Executive Summary
      - Package Details (name, version, GitHub URL)
      - Repository Statistics (stars, forks, license, open issues)
      - Maintenance Status (last commit, activity level, archived status)
      - Security Assessment
      - Recommendations for usage

      Keep it concise and actionable.
    output: final_report
