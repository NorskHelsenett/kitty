name: sbom-analyzer
version: 1.0.0
description: |
  Analyzes Software Bill of Materials (SBOM) files to extract package information,
  verify repository status, and check for unmaintained dependencies.
  
  Supports multiple package ecosystems including npm, Go, .NET, PyPI, and more.
  
author: Kitty Team
license: MIT

variables:
  sbom_file: ""
  output_format: "markdown"

tasks:
  - name: scan_purls
    description: Scan the SBOM file for PURLs without loading the entire file into the model
    tool: scan_sbom_purls
    input:
      file_path: "${sbom_file}"
      unique_only: true
      include_metadata: true
    output: packages_list

  - name: parse_sbom_metadata
    description: Parse the SBOM for component metadata such as licenses
    tool: parse_sbom
    input:
      file_path: "${sbom_file}"
      format: auto
    output: sbom_metadata

  - name: analyze_first_package
    description: Analyze the first package and extract GitHub repo info
    condition: packages_list exists
    prompt: |
      The SBOM scan produced the following package list (JSON):
      ${packages_list}

      1. Select the first meaningful GitHub package (e.g., pkg:golang/github.com/...)
      2. Extract the GitHub owner and repo name from the PURL
         Example: pkg:golang/github.com/gin-gonic/gin@v1.11.0 â†’ owner: gin-gonic, repo: gin
      3. Return JSON with keys: owner, repoURL, purl, name, version
         Example:
         {
           "owner": "gin-gonic",
           "repoURL": "https://github.com/gin-gonic/gin",
           "purl": "pkg:golang/github.com/gin-gonic/gin@v1.11.0",
           "name": "gin",
           "version": "v1.11.0"
         }
    output: package_info

  - name: get_github_repo_info
    description: Fetch GitHub repository information
    condition: package_info exists
    tool: github_repo_info
    input:
      owner: "${package_info.owner}"
      repo: "${package_info.repo}"
    output: repo_details

  - name: check_maintenance_status
    description: Check if the GitHub repository is actively maintained
    condition: repo_details exists
    tool: github_check_maintenance
    input:
      owner: "${package_info.owner}"
      repo: "${package_info.repo}"
    output: maintenance_status

  - name: generate_report
    description: Generate final security and maintenance report
    prompt: |
      Generate a comprehensive report for the analyzed package(s):

      Package Scan Results: ${packages_list}
      Detailed Component Metadata: ${sbom_metadata}
      Selected Package: ${package_info}
      Repository Details: ${repo_details}
      Maintenance Status: ${maintenance_status}

      Format the report as ${output_format} with:
      - Executive Summary
      - Package Details (name, version, license, stars, forks)
      - Repository Status (archived, last commit, activity level)
      - Security Concerns (if any)
      - Maintenance Status Assessment
      - Recommendations
    output: final_report
